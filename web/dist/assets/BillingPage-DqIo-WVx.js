import{r as t,j as e}from"./vendor-react-CfCdiEH_.js";import{a as i,o as n,s as a}from"./core-VSXNFQTj.js";import{f as l}from"./formatDiscount-BRtx8JzC.js";import"./vendor-ByYHSpNA.js";function s({token:s}){var o,r,c,d,u;const[p,h]=t.useState(null),[b,m]=t.useState(!1),[j,v]=t.useState(""),[y,x]=t.useState(""),[g,S]=t.useState(""),[f,k]=t.useState(1),w=async()=>{try{h(await i("/usage",{token:s}))}catch{}};t.useEffect((()=>{w()}),[s]);return e.jsxs("section",{children:[e.jsx("h2",{children:"Billing"}),p&&e.jsxs("div",{children:["Tier: ",p.tier," · Status: ",p.status,(null==(o=p.subscription)?void 0:o.cancel_at_period_end)?" · Cancel at period end: yes":"",(null==(r=p.subscription)?void 0:r.current_period_end)?` · Period ends: ${new Date(p.subscription.current_period_end).toLocaleDateString()}`:"",(null==(c=p.seats)?void 0:c.capacity)?` · Seats: ${p.seats.capacity}`:"",(null==(d=p.subscription)?void 0:d.discount)?e.jsxs(e.Fragment,{children:[" · ",e.jsxs("span",{"data-testid":"promo-banner","aria-label":"active-promo",children:["Promo: ",l(p.subscription.discount)]})]}):""]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{children:"Coupon/Promotion code (optional): "}),e.jsx("input",{value:y,onChange:t=>x(t.target.value),placeholder:"SUMMER100"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Price ID (optional): "}),e.jsx("input",{value:g,onChange:t=>S(t.target.value),placeholder:"price_123... (test)"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Seats (quantity): "}),e.jsx("input",{type:"number",min:1,value:f,onChange:t=>k(t.target.value),style:{width:80}})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:async()=>{m(!0),v("");try{const t={};y&&(t.coupon=y.trim()),g&&(t.price_id=g.trim()),Number.isFinite(Number(f))&&Number(f)>0&&(t.quantity=Number(f));const{url:e}=await i("/billing/checkout",{method:"POST",token:s,body:t});if(e){try{const t=new URL(e);n(t.toString())||a(t.toString(),["https://checkout.stripe.com"])}catch{n(e)}await w()}}catch{v("Checkout unavailable")}finally{m(!1)}},disabled:b,children:"Upgrade (Checkout)"}),e.jsx("button",{onClick:async()=>{m(!0),v("");try{const t=await i("/billing/portal",{method:"GET",token:s});if(null==t?void 0:t.url)try{const e=new URL(t.url);n(e.toString())||a(e.toString(),["https://billing.stripe.com"])}catch{n(t.url)}}catch{v("Portal unavailable")}finally{m(!1)}},disabled:b,children:"Open Billing Portal"}),(null==(u=null==p?void 0:p.subscription)?void 0:u.cancel_at_period_end)?e.jsx("button",{onClick:async()=>{m(!0),v("");try{await i("/billing/resume",{method:"POST",token:s,body:{}}),await w(),alert("Subscription resumed.")}catch{v("Resume failed")}finally{m(!1)}},disabled:b,children:"Resume"}):e.jsx("button",{onClick:async()=>{m(!0),v("");try{await i("/billing/cancel",{method:"POST",token:s,body:{}}),await w(),alert("Subscription will cancel at period end.")}catch{v("Cancel failed")}finally{m(!1)}},disabled:b,children:"Cancel at period end"})]}),j&&e.jsx("div",{children:j})]})}export{s as default};
