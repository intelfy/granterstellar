import{r as e,j as n}from"./vendor-react-CfCdiEH_.js";import{a as i}from"./core-VSXNFQTj.js";import"./vendor-ByYHSpNA.js";function t({token:t}){const[s,a]=e.useState([]),[r,d]=e.useState(""),[o,c]=e.useState(""),[l,h]=e.useState(""),[u,m]=e.useState({}),[j,v]=e.useState(""),[x,g]=e.useState("member"),[p,k]=e.useState({}),[b,y]=e.useState(""),S=async()=>{try{a(await i("/orgs/",{token:t}))}catch{}},w=async e=>{try{const n=await i(`/orgs/${e}/members/`,{token:t});m((i=>({...i,[e]:n})))}catch{}},C=async e=>{try{const n=await i(`/orgs/${e}/invites/`,{token:t});k((i=>({...i,[e]:n})))}catch{}};e.useEffect((()=>{S()}),[t]);return n.jsxs("section",{children:[n.jsxs("div",{children:[n.jsx("h2",{children:"Organizations"}),n.jsxs("div",{children:[n.jsx("input",{placeholder:"New org name",value:r,onChange:e=>d(e.target.value)}),n.jsx("input",{placeholder:"Description (optional)",value:o,onChange:e=>c(e.target.value)}),n.jsx("button",{onClick:async()=>{r&&(await i("/orgs/",{method:"POST",token:t,body:{name:r,description:o}}),d(""),c(""),S())},children:"Create"})]})]}),n.jsx("ul",{children:s.map((e=>{var s;return n.jsxs("li",{children:[n.jsxs("div",{children:[n.jsxs("strong",{children:["#",e.id]})," ",e.name,n.jsxs("span",{children:[" ",e.description]}),n.jsxs("span",{children:[" admin: ",null==(s=e.admin)?void 0:s.username]}),n.jsx("button",{onClick:()=>{const n=l===String(e.id);h(n?"":String(e.id)),n||(w(e.id),C(e.id))},children:l===String(e.id)?"Hide":"Manage"}),n.jsx("button",{onClick:()=>(async e=>{confirm("Delete this organization?")&&(await i(`/orgs/${e}/`,{method:"DELETE",token:t}),S())})(e.id),children:"Delete"})]}),l===String(e.id)&&n.jsxs("div",{children:[n.jsxs("div",{children:[n.jsx("div",{children:"Members"}),n.jsx("div",{children:"Invite by email"}),n.jsx("input",{placeholder:"name@example.com",value:j,onChange:e=>v(e.target.value)}),n.jsxs("select",{value:x,onChange:e=>g(e.target.value),children:[n.jsx("option",{value:"member",children:"member"}),n.jsx("option",{value:"admin",children:"admin"})]}),n.jsx("button",{onClick:()=>(async e=>{if(!j)return;const n=await i(`/orgs/${e}/invites/`,{method:"POST",token:t,body:{email:j,role:x}});v(""),await C(e),alert(`Invite created. Token (dev): ${n.token}`)})(e.id),children:"Invite"})]}),n.jsx("ul",{children:(u[e.id]||[]).map((s=>n.jsxs("li",{children:[s.user.username," (",s.user.id,") — ",s.role,n.jsx("button",{onClick:()=>(async(e,n)=>{await i(`/orgs/${e}/members/`,{method:"DELETE",token:t,body:{user_id:n}}),w(e)})(e.id,s.user.id),children:"Remove"})]},s.user.id)))}),n.jsxs("div",{children:[n.jsx("div",{children:"Pending invites"}),n.jsx("ul",{children:(p[e.id]||[]).map((s=>n.jsxs("li",{children:[s.email," — ",s.role," ",s.accepted_at?"(accepted)":s.revoked_at?"(revoked)":"(pending)",!s.accepted_at&&!s.revoked_at&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>(async(e,n)=>{await i(`/orgs/${e}/invites/`,{method:"DELETE",token:t,body:{id:n}}),await C(e)})(e.id,s.id),children:"Revoke"}),n.jsxs("span",{children:[" token: ",s.token]})]})]},s.id)))})]}),n.jsxs("div",{children:[n.jsx("div",{children:"Transfer ownership"}),n.jsx("input",{placeholder:"New admin user ID",value:b,onChange:e=>y(e.target.value)}),n.jsx("button",{onClick:()=>(async e=>{b&&(await i(`/orgs/${e}/transfer/`,{method:"POST",token:t,body:{user_id:Number(b)}}),y(""),S())})(e.id),children:"Transfer"})]})]})]},e.id)}))})]})}export{t as default};
