const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BillingPage-DqIo-WVx.js","assets/vendor-react-CfCdiEH_.js","assets/vendor-ByYHSpNA.js","assets/core-VSXNFQTj.js","assets/formatDiscount-BRtx8JzC.js","assets/AccountPage-CAsQAd4n.js","assets/Dashboard-yLS9-piM.js","assets/OrgsPage-Bd_-ubB_.js"])))=>i.map(i=>d[i]);
import{a as e,j as t,c as n,r as o}from"./vendor-react-CfCdiEH_.js";import{B as a,R as r,a as i,u as s,b as c,N as l}from"./vendor-router-D03co2gA.js";import"./vendor-ByYHSpNA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const d={},h=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));o=Promise.all(t.map((e=>{if((e=function(e){return"/static/app/"+e}(e))in d)return;d[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,n&&a.setAttribute("nonce",n),document.head.appendChild(a),t?new Promise(((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}return o.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))},u={UI_EXPERIMENTS:!1};function g({token:e}){return t.jsxs("div",{children:[t.jsx("h1",{children:"404 — Page not found"}),t.jsx("p",{children:"The page you're looking for doesn't exist. It may have been moved."}),t.jsxs("p",{children:[e?t.jsx("a",{href:`${f}`,children:"Go to the app"}):t.jsx("a",{href:`${f}/login`,children:"Go to login"})," ","· ",t.jsx("a",{href:`${f}`,children:"Homepage"})]})]})}const p="/api",m=!0,f="/app";function v(e){try{const t=String(e||"");if(!t)return`${f}`;if(/^https?:\/\//i.test(t)||t.startsWith("//"))return`${f}`;const n=t.startsWith("/")?t:`/${t}`;return n.startsWith(f)?n:`${f}`}catch{return`${f}`}}const j=e.lazy((()=>h((()=>import("./BillingPage-DqIo-WVx.js")),__vite__mapDeps([0,1,2,3,4])))),y=e.lazy((()=>h((()=>import("./AccountPage-CAsQAd4n.js")),__vite__mapDeps([5,1,2,3]))));e.lazy((()=>h((()=>import("./Dashboard-yLS9-piM.js")),__vite__mapDeps([6,1,2,3,4]))));const x=e.lazy((()=>h((()=>import("./Dashboard-yLS9-piM.js")),__vite__mapDeps([6,1,2,3,4])).then((e=>({default:n=>t.jsx(e.Proposals,{...n})})))));e.lazy((()=>h((()=>import("./Dashboard-yLS9-piM.js")),__vite__mapDeps([6,1,2,3,4])).then((e=>({default:n=>t.jsx(e.Orgs,{...n})})))));const k=e.lazy((()=>h((()=>import("./OrgsPage-Bd_-ubB_.js")),__vite__mapDeps([7,1,2,3]))));function w(){o.useEffect((()=>{}),[]);const e=s();return o.useEffect((()=>{try{window.umami&&"function"==typeof window.umami.track&&window.umami.track("pageview")}catch{}}),[e.pathname,e.search,e.hash]),null}function S({token:e}){const n=s(),a=c(),[r,i]=o.useState("");o.useEffect((()=>{try{const t=new URLSearchParams(n.search||"").get("invite")||"";i(e?t:"")}catch{i("")}}),[n.search,e]);const l=()=>{try{const e=new URLSearchParams(n.search||"");e.delete("invite");const t=e.toString(),o=`${n.pathname}${t?`?${t}`:""}${n.hash||""}`;a(o,{replace:!0})}catch{}};return e&&r?t.jsxs("div",{"data-testid":"invite-banner",role:"region","aria-label":"org-invite",children:[t.jsx("span",{children:"Organization invite detected."}),t.jsx("button",{type:"button","data-testid":"invite-accept",onClick:async()=>{var t;try{await _("/orgs/invites/accept",{method:"POST",token:e,body:{token:r}}),l(),i(""),a("/",{replace:!0}),alert("Invite accepted")}catch(n){alert("Invite accept failed: "+((null==(t=null==n?void 0:n.data)?void 0:t.error)||n.message))}},children:"Accept invite"}),t.jsx("button",{type:"button","data-testid":"invite-dismiss",onClick:()=>{l(),i("")},children:"Not now"})]}):null}async function _(e,{method:t="GET",token:n,body:o,orgId:a}={}){const r=await fetch(`${p}${e}`,{method:t,headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{},...a?{"X-Org-ID":a}:{}},body:o?JSON.stringify(o):void 0});let i=null;try{i=await r.json()}catch{}if(!r.ok){const e=new Error(`${r.status}`);throw e.status=r.status,e.data=i,e}return i}function b(e){return t.jsx(o.Suspense,{fallback:t.jsx("div",{children:"Loading…"}),children:t.jsx(j,{...e})})}function P(e){return t.jsx(o.Suspense,{fallback:t.jsx("div",{children:"Loading…"}),children:t.jsx(y,{...e})})}function I({token:e,setToken:n}){const[a,r]=o.useState("demo"),[i,l]=o.useState("demo12345"),[d,h]=o.useState(""),[u,g]=o.useState(""),[p,j]=o.useState(""),y=c(),x=s(),k=o.useMemo((()=>new URLSearchParams(x.search).get("next")||`${f}`),[x.search]),w=o.useMemo((()=>v(k)),[k]);o.useEffect((()=>{e&&y(w,{replace:!0})}),[e,w,y]),o.useEffect((()=>{const e=new URL(window.location.href),t=e.searchParams.get("invite");t&&g(t);const n=e.searchParams.get("oauth_error"),o=e.searchParams.get("oauth_code");if(n||o){j({email_unverified:"Your GitHub email is not verified. Verify it on GitHub or use another provider.",email_not_found:"Your provider did not share an email. Try a different provider or sign up manually.",token_exchange_failed:"Could not complete sign-in with the provider. Please try again.",invalid_id_token:"Invalid identity token from provider. Please retry.",missing_code:"Missing code from provider.",missing_access_token:"Provider did not return an access token.",oauth_not_configured:"OAuth is not configured on the server."}[o]||n||"Sign-in failed. Please try again."),e.searchParams.delete("oauth_error"),e.searchParams.delete("oauth_code"),window.history.replaceState({},"",e.toString())}}),[]);return t.jsxs("div",{children:[t.jsx("h1",{children:"Granterstellar"}),!m,t.jsx("button",{type:"button",onClick:async()=>{try{w&&sessionStorage.setItem("postLoginNext",w),sessionStorage.setItem("oauthProvider","google");const t=new URL(window.location.href).searchParams.get("invite"),n=t?`?invite=${encodeURIComponent(t)}`:"",o=await _(`/oauth/google/start${n}`,{token:e});if(null==o?void 0:o.auth_url)try{const e=new URL(o.auth_url),t="https://accounts.google.com"===e.origin&&"/o/oauth2/v2/auth"===e.pathname,n="https://github.com"===e.origin&&"/login/oauth/authorize"===e.pathname,a="https://www.facebook.com"===e.origin&&(/^\/v\d+(?:\.\d+)?\/dialog\/oauth$/.test(e.pathname)||"/dialog/oauth"===e.pathname);(t||n||a)&&window.location.assign(e.toString())}catch{}}catch{}},children:"Sign in with Google"}),t.jsx("button",{type:"button",onClick:async()=>{try{w&&sessionStorage.setItem("postLoginNext",w),sessionStorage.setItem("oauthProvider","github");const t=new URL(window.location.href).searchParams.get("invite"),n=t?`?invite=${encodeURIComponent(t)}`:"",o=await _(`/oauth/github/start${n}`,{token:e});if(null==o?void 0:o.auth_url)try{const e=new URL(o.auth_url);"https://github.com"===e.origin&&"/login/oauth/authorize"===e.pathname&&window.location.assign(e.toString())}catch{}}catch{}},children:"Sign in with GitHub"}),t.jsx("button",{type:"button",onClick:async()=>{try{w&&sessionStorage.setItem("postLoginNext",w),sessionStorage.setItem("oauthProvider","facebook");const t=new URL(window.location.href).searchParams.get("invite"),n=t?`?invite=${encodeURIComponent(t)}`:"",o=await _(`/oauth/facebook/start${n}`,{token:e});if(null==o?void 0:o.auth_url)try{const e=new URL(o.auth_url);"https://www.facebook.com"===e.origin&&(/^\/v\d+(?:\.\d+)?\/dialog\/oauth$/.test(e.pathname)||"/dialog/oauth"===e.pathname)&&window.location.assign(e.toString())}catch{}}catch{}},children:"Sign in with Facebook"}),!m,p&&t.jsx("div",{children:p}),!m,e&&u&&t.jsx("button",{type:"button",onClick:async()=>{var t;try{await _("/orgs/invites/accept",{method:"POST",token:e,body:{token:u}}),alert("Invite accepted");try{const e=new URL(window.location.href);e.searchParams.delete("invite");const t=`${e.pathname}${e.search}${e.hash}`;y(t,{replace:!0})}catch{}g("")}catch(n){alert("Invite accept failed: "+((null==(t=null==n?void 0:n.data)?void 0:t.error)||n.message))}},children:"Accept pending invite"})]})}function E({setToken:e}){const n=c(),a=s();return o.useEffect((()=>{const t=new URLSearchParams(a.search),o=t.get("code"),r=t.get("state"),i=v(sessionStorage.getItem("postLoginNext")||`${f}`),s=sessionStorage.getItem("oauthProvider")||"google";o?(async()=>{try{const t=new URLSearchParams({code:o});r&&t.set("state",r);const a=await fetch(`${p}/oauth/${s}/callback`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()}),c=await a.json().catch((()=>({})));if(!a.ok){const e=c&&(c.error||c.detail)||"oauth callback failed",t=c&&c.code||"",o=new URLSearchParams;return o.set("oauth_error",String(e)),t&&o.set("oauth_code",String(t)),void n(`/login?${o.toString()}`,{replace:!0})}if(null==c?void 0:c.access){e(c.access);try{const e=await _("/orgs/",{token:c.access});if(Array.isArray(e)&&0===e.length){const e=i||`${f}`;n(`/register?next=${encodeURIComponent(e)}`,{replace:!0})}else n(i||`${f}`,{replace:!0})}catch{n(i||`${f}`,{replace:!0})}}else n("/login?oauth_error=Unknown",{replace:!0})}catch{n("/login?oauth_error=Network%20error",{replace:!0})}finally{sessionStorage.removeItem("postLoginNext"),sessionStorage.removeItem("oauthProvider")}})():n("/login",{replace:!0})}),[a.search,n,e]),t.jsx("div",{children:"Signing you in…"})}function $({token:e,children:n}){const[a,r]=o.useState(!0),[i,l]=o.useState(!0),d=s(),h=c();return o.useEffect((()=>{let t=!1;return(async()=>{r(!0);try{const n=await _("/orgs/",{token:e});if(!t){const e=Array.isArray(n)&&n.length>0;if(l(e),!e){const e=encodeURIComponent(d.pathname+d.search);h(`/register?next=${e}`,{replace:!0})}}}catch{t||l(!0)}finally{t||r(!1)}})(),()=>{t=!0}}),[e,d.pathname,d.search,h]),a?t.jsx("div",{children:"Loading…"}):i?n:null}function L({token:e}){const[n,a]=o.useState(""),[r,i]=o.useState(""),[l,d]=o.useState(""),[h,u]=o.useState("free"),[g,p]=o.useState(!1),m=c(),v=s(),j=o.useMemo((()=>new URLSearchParams(v.search).get("next")||`${f}`),[v.search]);return t.jsxs("div",{children:[t.jsx("h2",{children:"Complete your registration"}),t.jsxs("form",{onSubmit:async t=>{var n;t.preventDefault(),p(!0);try{if(l?await _("/orgs/invites/accept",{method:"POST",token:e,body:{token:l}}):r&&await _("/orgs/",{method:"POST",token:e,body:{name:r}}),"pro"===h||"enterprise"===h)try{const{url:t}=await _("/billing/checkout",{method:"POST",token:e,body:{}});t&&window.open(t,"_blank")}catch{}m(j||`${f}`,{replace:!0})}catch(o){alert("Registration failed: "+((null==(n=null==o?void 0:o.data)?void 0:n.error)||o.message))}finally{p(!1)}},children:[t.jsx("input",{value:n,onChange:e=>a(e.target.value),placeholder:"Your name"}),t.jsx("input",{value:r,onChange:e=>i(e.target.value),placeholder:"Organization name (or leave blank if using an invite)"}),t.jsx("input",{value:l,onChange:e=>d(e.target.value),placeholder:"Invite token (optional)"}),!l&&t.jsxs("div",{children:[t.jsx("div",{children:"Choose a plan"}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"plan",value:"free",checked:"free"===h,onChange:e=>u(e.target.value)})," Free"]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"plan",value:"pro",checked:"pro"===h,onChange:e=>u(e.target.value)})," Pro"]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"plan",value:"enterprise",checked:"enterprise"===h,onChange:e=>u(e.target.value)})," Enterprise"]})]}),t.jsx("button",{type:"submit",disabled:g,children:"Continue"})]})]})}function C({token:e,setToken:n}){const[a,r]=o.useState((()=>localStorage.getItem("orgId")||"")),[i,s]=o.useState([]);o.useEffect((()=>{a?localStorage.setItem("orgId",a):localStorage.removeItem("orgId")}),[a]),o.useEffect((()=>{(async()=>{try{const t=await _("/orgs/",{token:e});s(Array.isArray(t)?t:[])}catch{}})()}),[e]);const l=c();return t.jsxs("div",{children:[u.UI_EXPERIMENTS,!a&&Array.isArray(i)&&i.length>0&&t.jsxs("div",{children:[t.jsx("span",{children:"Tip: Select an organization to scope your work."}),t.jsxs("select",{value:a,onChange:e=>r(e.target.value),children:[t.jsx("option",{value:"",children:"Choose…"}),i.map((e=>t.jsxs("option",{value:String(e.id),children:["#",e.id," ",e.name]},e.id)))]}),t.jsx("button",{onClick:()=>l("/register"),children:"Create a new org"})]}),t.jsxs("div",{children:[t.jsx("h1",{children:"Granterstellar"}),t.jsx("button",{onClick:()=>{n(""),l("/login",{replace:!0})},children:"Logout"}),t.jsx("button",{onClick:()=>l("/account"),children:"Account"}),t.jsx("button",{onClick:()=>l("/billing"),children:"Billing"}),t.jsx("button",{onClick:()=>l("/orgs"),children:"Organizations"})]}),t.jsx("div",{children:t.jsx(o.Suspense,{fallback:t.jsx("div",{children:"Loading…"}),children:t.jsx(x,{token:e,selectedOrgId:a})})})]})}function R({token:e,children:n}){const o=s();if(!e){const e=encodeURIComponent(o.pathname+o.search);return t.jsx(l,{to:`/login?next=${e}`,replace:!0})}return n}function T(){const[e,n]=function(){const[e,t]=o.useState((()=>localStorage.getItem("jwt")||""));return[e,e=>{t(e||""),e?localStorage.setItem("jwt",e):localStorage.removeItem("jwt")}]}();return o.useEffect((()=>{const e=navigator&&"connection"in navigator?navigator.connection:null,t=e&&e.saveData,n=e&&("2g"===e.effectiveType||"slow-2g"===e.effectiveType);if(t||n)return;const o=()=>{try{h((()=>import("./BillingPage-DqIo-WVx.js")),__vite__mapDeps([0,1,2,3,4]))}catch{}try{h((()=>import("./AccountPage-CAsQAd4n.js")),__vite__mapDeps([5,1,2,3]))}catch{}try{h((()=>import("./OrgsPage-Bd_-ubB_.js")),__vite__mapDeps([7,1,2,3]))}catch{}};"requestIdleCallback"in window?window.requestIdleCallback(o,{timeout:2e3}):setTimeout(o,500)}),[]),o.useEffect((()=>{}),[]),t.jsxs(a,{basename:f,children:[t.jsx(w,{}),t.jsx(S,{token:e}),t.jsxs(r,{children:[t.jsx(i,{path:"/login",element:t.jsx(I,{token:e,setToken:n})}),t.jsx(i,{path:"/register",element:t.jsx(R,{token:e,children:t.jsx(L,{token:e})})}),t.jsx(i,{path:"/oauth/callback",element:t.jsx(E,{setToken:n})}),t.jsx(i,{path:"/billing",element:t.jsx(R,{token:e,children:t.jsx(b,{token:e})})}),t.jsx(i,{path:"/account",element:t.jsx(R,{token:e,children:t.jsx(P,{token:e})})}),t.jsx(i,{path:"/orgs",element:t.jsx(R,{token:e,children:t.jsx(o.Suspense,{fallback:t.jsx("div",{children:"Loading…"}),children:t.jsx(k,{token:e})})})}),t.jsx(i,{path:"/404",element:t.jsx(g,{token:e})}),t.jsx(i,{path:"*",element:t.jsx(R,{token:e,children:t.jsx($,{token:e,children:t.jsx(C,{token:e,setToken:n})})})})]})]})}const O="undefined"!=typeof document?document.getElementById("root"):null;if(O){n(O).render(t.jsx(T,{}))}
